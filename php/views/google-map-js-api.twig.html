   <div style="width: 600px;">
     <div class="google-maps" id="map"></div> 
   </div>
   <script type="text/javascript" src="{{ gvm.RR_DOC_ROOT }}js/savemapview.js"></script>
   <script type="text/javascript">
   var riprunner_js_map = null;
function map_initialize() {
    //debugger;
	var directionsService = new google.maps.DirectionsService();
	var directionsDisplay = new google.maps.DirectionsRenderer();
	
	{% block map_water_sources %}
	var waterSource = [
      //
      // Set water sources here
      //
      //['LOCATION1 - WATER AMOUNT', lattitude, longtitude, 1],
	  //['LOCATION2 - WATER AMOUNT', lattitude, longtitude, 2],
    ];
	{% endblock %}
	
	{% block map_firehalls %}
	// Set other RDFFG Firehall locations here
	var fireHalls = [
	   //["PILOT MTN FIRE DEPARTMENT", 54.011258, -122.854466, 5],
	   //["SALMON VALLEY FIRE DEPARTMENT", 54.091680, -122.653749, 7]
	];
	{% endblock %}

    var mapzoom = 13;
    var mapcenter = new google.maps.LatLng({{ CALLORIGIN }});
    var maplat = mapcenter.lat();
    var maplng = mapcenter.lng();
    var maptypeid = google.maps.MapTypeId.ROADMAP;
	
    //debugger;
    var initialZoom = true;
	
    var map = new google.maps.Map(document.getElementById('map'), {
		zoom: mapzoom,
		center: mapcenter,
		draggable: true,
		scrollwheel: true,
		mapTypeId: maptypeid,
		zoomControl: true,
		zoomControlOptions: {
			position: google.maps.ControlPosition.LEFT_TOP
		}
    });
    //LoadView(map);
    
	directionsDisplay.setMap(map);
	var request = {
		destination: "{{ DESTINATION }}", 
		origin: "{{ FDLOCATION }}",
		travelMode: google.maps.DirectionsTravelMode.DRIVING
	};

	var callOriginMarker = new google.maps.Marker({
		map: map,
		position: new google.maps.LatLng({{ CALLORIGIN }}), 
		title: "DESTINATION",
		clickable: true,
		icon: {
			path: google.maps.SymbolPath.CIRCLE,
			scale: 9,
			fillColor: "yellow",
			fillOpacity: 0.9,
			strokeWeight: 0.9
		}
	});

    var infowindow = new google.maps.InfoWindow();
    var marker, i;
    for (i = 0; i < waterSource.length; i++) {  
      marker = new google.maps.Marker({
        position: new google.maps.LatLng(waterSource[i][1], waterSource[i][2]),
   			icon: {
				path: google.maps.SymbolPath.CIRCLE,
				scale: 9,
				fillColor: "blue",
				fillOpacity: 0.9,
				strokeWeight: 0.9
			},
		map: map
      });
      google.maps.event.addListener(marker, 'click', (function(marker, i) {
        return function() {
          infowindow.setContent(waterSource[i][0]);
          infowindow.open(map, marker);
        }
      })(marker, i));
	}
	
    var infowindow = new google.maps.InfoWindow();
    var marker, i;
    for (i = 0; i < fireHalls.length; i++) { 
        marker = new google.maps.Marker({
            position: new google.maps.LatLng(fireHalls[i][1], fireHalls[i][2]),
        	icon: {
				path: google.maps.SymbolPath.BACKWARD_CLOSED_ARROW,
				scale: 5,
				fillColor: "red",
				fillOpacity: 0.5,
				strokeWeight: 0.9
			},
			map: map
	    });
		google.maps.event.addListener(marker, 'click', (function(marker, i) {
			  return function() {
				  infowindow.setContent(fireHalls[i][0]);
		          infowindow.open(map, marker);
		      }
		})(marker, i));
	}
    
	directionsService.route(request, function(response, status) {
		if (status == google.maps.DirectionsStatus.OK) {
			directionsDisplay.setDirections(response);
		}
		
		{% block map_boundaries %}
		//
		// Set map bounds here
		//
		//var boundaryLayer = new google.maps.KmlLayer({
		//	url: '{{ WEB_ROOT }}kml/boundaries.kml',
		//	preserveViewport: true,
		//	supressInfoWindows: true
		//});
		//boundaryLayer.setMap(map);
		{% endblock %}
		
	    if(marker != null) {
	        marker.setMap(map);
	    }
	    
	    try {
	    	getGEOLocationCoords_initialize();
	    }
	    catch(e) {
	    	console.info('Error calling getGEOLocationCoords_initialize msg: ' + e.message);	    	
	    }
	});

	// Restore previous map settings if they exist
    google.maps.event.addListener(map, 'zoom_changed', function () {
    	console.info('In zoom_changed');
        zoomChangeBoundsListener = google.maps.event.addListener(map, 'bounds_changed', function (event) {
        	console.info('In zoom_changed + bounds_changed');
        	try {
	            if (initialZoom == true) {
	            	initialZoom = false;
	            	console.info('Updating zoom...');
	                LoadView(this);
	            }
        	}
            catch(e) {
                console.info('Error calling LoadView msg: ' + e.message);            
            }
        	
            google.maps.event.removeListener(zoomChangeBoundsListener);
        });
    });
    	
	riprunner_js_map = map;
}
   
   function loadScript(src,callback) {
	   var script = document.createElement("script");
	   script.type = "text/javascript";
	   if(callback) {
		    script.onload = callback;
	   }
	   document.getElementsByTagName("head")[0].appendChild(script);
	   script.src = src;
   }
   $( document ).ready(function() {
      loadScript('https://maps.googleapis.com/maps/api/js?v=3.exp&key={{ callout_details_vm.firehall.WEBSITE.WEBSITE_GOOGLE_MAP_API_KEY }}&alternatives=true&callback=map_initialize' );
   });
</script>
